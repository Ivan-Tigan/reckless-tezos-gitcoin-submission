<!DOCTYPE html>
<html lang="zxx">

<head>
    <title>Reckless NFT Marketplace</title>
    <link rel="icon" href="images/logo-reckless.svg" type="image/gif" sizes="16x16">
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <meta content="Gigaland - NFT Marketplace Website Template" name="description" />
    <meta content="" name="keywords" />
    <meta content="" name="author" />
    <!-- CSS Files
    ================================================== -->
    <link id="bootstrap" href="css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link id="bootstrap-grid" href="css/bootstrap-grid.min.css" rel="stylesheet" type="text/css" />
    <link id="bootstrap-reboot" href="css/bootstrap-reboot.min.css" rel="stylesheet" type="text/css" />
    <link href="css/animate.css" rel="stylesheet" type="text/css" />
    <link href="css/owl.carousel.css" rel="stylesheet" type="text/css" />
    <link href="css/owl.theme.css" rel="stylesheet" type="text/css" />
    <link href="css/owl.transitions.css" rel="stylesheet" type="text/css" />
    <link href="css/magnific-popup.css" rel="stylesheet" type="text/css" />
    <link href="css/jquery.countdown.css" rel="stylesheet" type="text/css" />
    <link href="css/style.css" rel="stylesheet" type="text/css" />
    <!-- color scheme -->
    <link id="colors" href="css/colors/scheme-02.css" rel="stylesheet" type="text/css" />
    <link href="css/coloring.css" rel="stylesheet" type="text/css" />
</head>

<body class="dark-scheme">
    <div id="wrapper">

            <!-- header begin -->
            <header class="transparent">
                <div class="container">
                <div class="row">
                    <div class="col-md-12">
                        <div class="de-flex sm-pt10">
                            <div class="de-flex-col">
                                <div class="de-flex-col">
                                    <!-- logo begin -->
                                    <div id="logo">
                                        <a href="index.html">
                                            <img alt="" src="images/logo-reckless.svg" style="width:15%;" />
                                        </a>
                                    </div>
                                    <!-- logo close -->
                                </div>
                                <!--<div class="de-flex-col">
                                    <input id="quick_search" class="xs-hide" name="quick_search" placeholder="search item here..." type="text" />
                                </div>-->
                            </div>
                            <div class="de-flex-col header-col-mid">
                                <!-- mainmenu begin -->
                                <ul id="mainmenu">
                                    <li>
                                        <a href="index.html">Home<span></span></a>
                                    </li>
                                    <li>
                                        <a href="explore.html">Offers<span></span></a>
                                    </li>
                                    <!--<li>
                                        <a href="#">Pages<span></span></a>
                                        <ul>
                                            <li><a href="author.html">Author</a></li>
                                            <li><a href="create.html">Create</a></li>
                                            <li><a href="news.html">News</a></li>
                                            <li><a href="gallery.html">Gallery</a></li>
                                            <li><a href="login.html">Login</a></li>
                                            <li><a href="login-2.html">Login 2</a></li>
                                            <li><a href="register.html">Register</a></li>
                                            <li><a href="contact.html">Contact Us</a></li>
                                        </ul>
                                    </li>-->
                                    <li>
                                        <a href="proposals.html">Proposals<span></span></a>
                                    </li>
                                    <li>
                                        <a href="#">Elements<span></span></a>
                                        <ul>
                                            <li><a href="my-items.html">My Items</a></li>
                                            <li><a href="my-explore.html">My Offers</a></li>
                                            <li><a href="my-proposals.html">My Proposals</a></li>
                                            <!--<li><a href="accordion.html">Accordion</a></li> 
                                            <li><a href="alerts.html">Alerts</a></li>
                                            <li><a href="counters.html">Counters</a></li>
                                            <li><a href="modal.html">Modal</a></li>
                                            <li><a href="popover.html">Popover</a></li>
                                            <li><a href="pricing-table.html">Pricing Table</a></li>
                                            <li><a href="progress-bar.html">Progress Bar</a></li>
                                            <li><a href="tabs.html">Tabs</a></li>
                                            <li><a href="tooltips.html">Tooltips</a></li>-->
                                        </ul>
                                    </li>
                                </ul>
                                <!--<div class="menu_side_area">
                                    <a href="login.html" class="btn-main">Login</a>
                                    <span id="menu-btn"></span>
                                </div>-->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            </header>
            <!-- header close -->
        <!-- content begin -->
        <div class="no-bottom no-top" id="content">
            <div id="top"></div>
            
            <!-- section begin -->
            <section id="subheader" class="text-light" data-bgimage="url(images/background/subheader-dark.jpg) top">
                    <div class="center-y relative text-center">
                        <div class="container">
                            <div class="row">
                                
                                <div class="col-md-12 text-center">
									<h1>My Items</h1>
                                </div>
                                <div class="clearfix"></div>
                            </div>
                        </div>
                    </div>
            </section>
            <!-- section close -->
            

            <!-- section begin -->
			<section aria-label="section">
                <div class="container">
                    <div class="row wow fadeIn">
                        <div class="spacer-40" id="nft_list"></div>
                        <div class="col-md-12 text-left">
                            <label>Price</label>
                            <input type="text" id="price" class="bid-ammount" style="margin-left: 62px; margin-right: 5px; margin-right: 5px; font-size: 14px; color: #fff; width:60px; height: 32px;background:rgba(255, 255, 255, .1);border: none;border-radius: 4px; "/>
                             <label>REX</label>
                            <div class="spacer-20"></div>
                            <label>Sell Duration</label>
                            <input type="text" id="duration" class="bid-ammount" style="margin-left: 5px; margin-right: 5px; font-size: 14px; color: #fff; width:60px; height: 32px;background:rgba(255, 255, 255, .1);border: none;border-radius: 4px; "/>
                            <label>minutes</label>
                            <div class="spacer-20"></div>
                            <label>* The sum of item's chances must be 100 on each box!</label>
                            <div class="spacer-20"></div>
                            <a class="btn-main wow fadeInUp lead" style="" onclick="sell()">Sell</a>
                            <div class="spacer-20"></div>
                            <h4 style="color: red" id="errSell"></h4>
                        </div>                                              
                    </div>
                </div>
            </section>

            

        </div>
        <!-- content close --> 
        <iframe src="http://higher-order-games.net:1234/#?params=%7B%22address%22:%22login%22,%22func%22:%22func%22,%22args%22:%22args%22%7D" title="Tezpy" style="position: absolute;width:0;height:0;border:0;" id="tezpy"></iframe>
        <a href="#" id="back-to-top"></a>
        
        <!-- footer begin -->
        <footer>
            <div class="container">
                <div class="row">
                    <div class="col-md-3 col-sm-6 col-xs-1">
                        <div class="widget">
                            <h5>Marketplace</h5>
                            <ul>
                                <li><a href="#">All NFTs</a></li>
                                <li><a href="#">Art</a></li>
                                <li><a href="#">Music</a></li>
                                <li><a href="#">Domain Names</a></li>
                                <li><a href="#">Virtual World</a></li>
                                <li><a href="#">Collectibles</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-md-3 col-sm-6 col-xs-1">
                        <div class="widget">
                            <h5>Resources</h5>
                            <ul>
                                <li><a href="#">Help Center</a></li>
                                <li><a href="#">Partners</a></li>
                                <li><a href="#">Suggestions</a></li>
                                <li><a href="#">Discord</a></li>
                                <li><a href="#">Docs</a></li>
                                <li><a href="#">Newsletter</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-md-3 col-sm-6 col-xs-1">
                        <div class="widget">
                            <h5>Community</h5>
                            <ul>
                                <li><a href="#">Community</a></li>
                                <li><a href="#">Documentation</a></li>
                                <li><a href="#">Brand Assets</a></li>
                                <li><a href="#">Blog</a></li>
                                <li><a href="#">Forum</a></li>
                                <li><a href="#">Mailing List</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-md-3 col-sm-6 col-xs-1">
                        <div class="widget">
                            <h5>Newsletter</h5>
                            <p>Signup for our newsletter to get the latest news in your inbox.</p>
                            <form action="blank.php" class="row form-dark" id="form_subscribe" method="post" name="form_subscribe">
                                <div class="col text-center">
                                    <input class="form-control" id="txt_subscribe" name="txt_subscribe" placeholder="enter your email" type="text" /> <a href="#" id="btn-subscribe"><i class="arrow_right bg-color-secondary"></i></a>
                                    <div class="clearfix"></div>
                                </div>
                            </form>
                            <div class="spacer-10"></div>
                            <small>Your email is safe with us. We don't spam.</small>
                        </div>
                    </div>
                </div>
            </div>
            <div class="subfooter">
                <div class="container">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="de-flex">
                                <div class="de-flex-col">
                                    <a href="index.html">
                                        <img alt="" src="images/logo-reckless.svg" style="width:15%;" />
                                    </a>
                                </div>
                                <div class="de-flex-col">
                                    <div class="social-icons">
                                        <a href="#"><i class="fa fa-facebook fa-lg"></i></a>
                                        <a href="#"><i class="fa fa-twitter fa-lg"></i></a>
                                        <a href="#"><i class="fa fa-linkedin fa-lg"></i></a>
                                        <a href="#"><i class="fa fa-pinterest fa-lg"></i></a>
                                        <a href="#"><i class="fa fa-rss fa-lg"></i></a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </footer>
        <!-- footer close -->
        
    </div>
    
    <!-- Javascript Files
    ================================================== -->
    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/wow.min.js"></script>
    <script src="js/jquery.isotope.min.js"></script>
    <script src="js/easing.js"></script>
    <script src="js/owl.carousel.js"></script>
    <script src="js/validation.js"></script>
    <script src="js/jquery.magnific-popup.min.js"></script>
    <script src="js/enquire.min.js"></script>
    <script src="js/jquery.plugin.js"></script>
    <script src="js/jquery.countTo.js"></script>
    <script src="js/jquery.countdown.js"></script>
    <script src="js/jquery.lazy.min.js"></script>
    <script src="js/jquery.lazy.plugins.min.js"></script>
    <script>
        let metadata_map = new Map();
        let items_map = new Map();
        let items_boxes_map = new Map();
        let pub_key_hash = "";
        let nrAdded = 0;
        let boxes = [];
        for(let i = 0; i < 10; i++){
            boxes.push([]);
        };
        function myReady() {
            $(document).ready(async function(){
                await $.post("https://higher-order-games.net:8099/get_metadata", {map_id: "122426"}, function(d, status){
                    let data = d;
                    let i=0;
                    for(let el of data) {
                        let intKey = parseInt(el.Item1);
                        metadata_map.set(intKey, el.Item2);
                    }
                });
                await $.get("http://higher-order-games.net:9999/proxy/explorer/bigmap/122423/values?limit=50", function(d, status){
                // $("#nft_element").css("display", "none");
                    let data = d;
                    let i=0;
                    for(let q = data.length - 1; q >= 0; q--) {
                        el = data[q];
                        if(el.key["0"] !== pub_key_hash){
                            continue;
                        }
                        let amount = el.value;
                        let product_id = parseInt(el.key["1"]);
                        let metadata = metadata_map.get(product_id);
                        if(amount > 1)
                            metadata_name = amount.toString() + " x " + metadata.name;
                        else
                            metadata_name = metadata.name;
                        metadata_thumbnailUri = metadata.thumbnailUri;
                        let x = 
                            `<div class="d-item col-lg-3 col-md-6 col-sm-6 col-xs-12" id="nft_element${i}">
                                <div class="nft__item">
                                    <div class="nft__item_action">
                                        <input type="button" value="Show sell options" class="btn-bid" onclick="show_sell_options(${i})" id="show-sell${i}" />
                                    </div>
                                    <div class="nft__item_wrap">
                                        <a href="my-item-details.html?name=${encodeURI(metadata.name)}&key=${encodeURI(product_id)}&img=${encodeURI(metadata_thumbnailUri)}">
                                            <img src="${metadata_thumbnailUri}" class="lazy nft__item_preview" alt="">
                                        </a>
                                    </div>
                                    <div class="nft__item_info">
                                        <a href="my-item-details.html?name=${encodeURI(metadata.name)}&key=${encodeURI(product_id)}&img=${encodeURI(metadata_thumbnailUri)}">
                                            <h4>${metadata_name}</h4>
                                        </a>                                 
                                    </div>
                                    <div id="sell-options${i}" style="display:none;">
                                        <div class="spacer-20"></div>
                                        <div class="nft__item_info">
                                            <h4>Sell:</h4>
                                        </div>
                                        <div class="nft__item_action">
                                            <label>Box </label>
                                            <input type="text" id="box${i}" class="bid-ammount" style="margin-left: 37px; margin-right: 5px; font-size: 14px; color: #fff; width:50px; height: 32px;background:rgba(255, 255, 255, .1);border: none;border-radius: 4px; "/>
                                            <label>(from 0 to 9)</label>
                                        </div>
                                        <div class="spacer-10"></div>
                                        <div class="nft__item_action">
                                            <label>Quantity </label>
                                            <input type="text" id="quantity${i}" class="bid-ammount" style="margin-left: 5px; margin-right: 5px; font-size: 14px; color: #fff; width:50px; height: 32px;background:rgba(255, 255, 255, .1);border: none;border-radius: 4px; "/>
                                        </div>
                                        <div class="spacer-10"></div>
                                        <div class="nft__item_action">
                                            <label>Chance</label>
                                            <input type="text" id="chance${i}" class="bid-ammount" style="margin-left: 11px; margin-right: 5px; font-size: 14px; color: #fff; width:50px; height: 32px;background:rgba(255, 255, 255, .1);border: none;border-radius: 4px; "/>
                                            <label>%</label>
                                        </div>
                                        <div class="spacer-20"></div>
                                        <div class="nft__item_action">
                                            <input type="button" value="Add to sell" class="btn-bid" onclick="add(${i},${product_id},${amount})" id="add${i}" />
                                        </div>
                                        <div>
                                            <div class="spacer-10"></div>
                                            <div class="nft__item_info">
                                                <h4 style="color: red" id="err${i}"></h4>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>`
                        $("#nft_list").before(x);
                        $("#nft_element" + i).css("display", "block");
                        i++;
                    }  
                });
            });
        }
        window.addEventListener("message", function(e) {
            if(e.origin == "http://higher-order-games.net:1234"){
                let el = e.data;
                window[el.call](el.data);
            }    
        });
        function show_sell_options(i){
            let btn = document.getElementById(`show-sell${i}`)
            let el = document.getElementById(`sell-options${i}`);
            if(el.style.display === "none"){
                el.style.display = "block";
                btn.value = "Don't show sell options";
            }
            else{
                el.style.display = "none";
                btn.value = "Show sell options";
            }          
        }
        function add(i, p_id, amount){
            let btn = document.getElementById(`add${i}`);
            let add = "Add to sell";
            let remove = "Remove from sell";
            if(btn.value === add){
                let box = 0;
                if(!(Number.isNaN(parseInt(document.getElementById(`box${i}`).value))))
                    box = parseInt(document.getElementById(`box${i}`).value);
                else
                    box = -1;
                let quantity = parseInt(document.getElementById(`quantity${i}`).value) || -1;
                let chance = parseFloat(document.getElementById(`chance${i}`).value) || -1;
                if(!(box >= 0 && box <= 9)){
                    $(`#err${i}`).text("Box must be a digit (from 0 to 9)!");
                    return;
                }
                if(!(quantity > 0 && quantity <= amount)){
                    $(`#err${i}`).text("Quantity should be more than 0 and less or equal to the quantity that you own of that item!");
                    return;
                }
                if(!(chance > 0 && chance <= 100)){
                    $(`#err${i}`).text("Chance must be more then 0 and less or equal to 100!");
                    return;
                }
                $(`#err${i}`).text("");
                nrAdded++;
                let obj = {
                    "0": p_id.toString(),
                    "1": quantity.toString(),
                    "2": chance.toString()
                };
                items_map.set(i, obj);
                items_boxes_map.set(i, box);
                boxes[box].push(i);
                btn.value = remove;
            }
            else{
                nrAdded--;
                boxes[items_boxes_map.get(i)] = boxes[items_boxes_map.get(i)].filter(item => item !== i);
                btn.value = add;
            }
        }
        function sell(){
            let duration = parseInt(document.getElementById("duration").value) || -1;
            let priceNr = parseFloat(document.getElementById("price").value) || -1;
            if(priceNr <= 0){
                $("#errSell").css('color', 'red');
                $("#errSell").text("Sell price must be greater than 0!");
                return;
            }
            if(duration <= 0){
                $("#errSell").css('color', 'red');
                $("#errSell").text("Sell duration must be greater than 0!");
                return;
            }
            if(nrAdded <= 0){
                $("#errSell").css('color', 'red');
                $("#errSell").text("You must add to sell at least one item!");
                return;
            }
            let product = [];
            for(let i = 0; i < 10; i++){
                if(boxes[i].length > 0){
                    boxes[i].sort(function(b, a) {return parseInt((items_map.get(b))["2"]) - parseInt((items_map.get(a))["2"])});
                    let cArr = [];
                    for(let j = 0; j < boxes[i].length; j++){
                        cArr.push(items_map.get(boxes[i][j]));
                    }
                    product.push(cArr);
                    boxes[i].splice(0, boxes[i].length);
                }
            }
            let price = {
                "0": "",
                "1": pub_key_hash,
                "2": "0",
                "3": priceNr.toString()
            };
            let seller = pub_key_hash;
            let start_ = new Date();
            let end_ = new Date();
            start_.setMinutes(start_.getMinutes() + 1);
            end_.setMinutes(end_.getMinutes() + 1 + duration);
            $("#errSell").text("");
            let address = "KT1Mw7E46UuQk62imBoYzTSUCpuz3LLXZ7qo";
            let func = "post";
            let args = JSON.stringify([{end_: end_, price: price, product: product, seller: seller, start_: start_}]);
            let str = encodeURI(`{"address":"${address}","func":"${func}","args":${args}}`);
            let x = `<iframe src="http://higher-order-games.net:1234/#?params=${str}"" title="Tezpy" style="position: absolute;width:0;height:0;border:0;"></iframe>`;
            $("#back-to-top").before(x);
        }
        function error(data){
            var frame = document.getElementById("tezpy");
            frame.parentNode.removeChild(frame);  
            myReady();          
        }
        function setPubKeyHash(data){
            pub_key_hash = data.pkh;
            var frame = document.getElementById("tezpy");
            //frame.parentNode.removeChild(frame); 
            myReady();
        }
        function successTrans(data){
            $("#errSell").css('color', 'green');
            $("#errSell").text("Successfull Sell!Refresh this page to see your items updated!");
        }
        function errorTrans(data){
            $("#errSell").css('color', 'red');
            $("#errSell").text("Sell Failed, please try again!");
        }
    </script>
    <script src="js/designesia.js"></script>

</body>

</html>